databases:
  - name: logfire-render-db
    databaseName: render_qa_db
    user: render_qa_user
    plan: basic-1gb
    region: oregon
    postgresMajorVersion: "17"

services:
  # Backend API (FastAPI)
  - type: web
    name: logfire-render-api
    runtime: python
    plan: starter
    region: oregon
    buildCommand: pip install --no-cache-dir -r backend/requirements.txt
    startCommand: uvicorn backend.main:app --host 0.0.0.0 --port $PORT
    healthCheckPath: /health
    envVars:
      - key: OPENAI_API_KEY
        sync: false
      - key: ANTHROPIC_API_KEY
        sync: false
      - key: LOGFIRE_TOKEN
        sync: false
      - key: LOGFIRE_READ_TOKEN
        sync: false
      - key: DATABASE_URL
        fromDatabase:
          name: logfire-render-db
          property: connectionString
      - key: QUALITY_THRESHOLD
        value: "85"
      - key: ACCURACY_THRESHOLD
        value: "70"
      - key: MAX_ITERATIONS
        value: "1"
      - key: MAX_TOKENS
        value: "2000"
      - key: RAG_TOP_K
        value: "20"
      - key: SIMILARITY_THRESHOLD
        value: "0.3"
      - key: VERIFICATION_THRESHOLD
        value: "0.30"
      - key: ENABLE_CACHING
        value: "true"
      - key: LOG_LEVEL
        value: INFO

  # Frontend (Next.js + TypeScript + Tailwind)
  - type: web
    name: logfire-render-frontend
    runtime: static
    rootDir: frontend
    buildCommand: rm -rf node_modules/.cache .next out && npm ci && npm run build
    staticPublishPath: out
    pullRequestPreviewsEnabled: true
    envVars:
      - key: NEXT_PUBLIC_API_URL
        fromService:
          name: logfire-render-api
          type: web
          property: host
    routes:
      - type: rewrite
        source: /*
        destination: /index.html

